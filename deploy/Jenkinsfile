pipeline {
    agent any
    parameters {
        string(name: 'DEPLOY_COMMIT', description: 'commit to deploy to website')
        //choice(name: 'TARGET', choices: ['One', 'Two', 'Three'], description: 'Choose Deployment Target')
    }
    stages {
        stage('Deploy static website files') {
            steps {
                withAWS(credentials:"aws", region:"eu-central-1"){
                    script{
                            String path = "karaokemp-website/COMMIT-${DEPLOY_COMMIT}/frontend"
                            int pathLength = path.length()
                            files = s3FindFiles(bucket:'karaokemp-artifacts', glob:"${path}/**", onlyFiles: true)
                            files.each {
                                itemObject -> echo "item path: ${itemObject}"
                                String itemPath = itemObject.toString()
                                String item = itemPath.drop(pathLength)
                                echo "item: ${item}"
                                s3Copy(pathStyleAccessEnabled: true, fromBucket:"karaokemp-artifacts", fromPath:"${item}", toBucket:'karaokemp-website', toPath:"${item}")
                            }
                    }
                }
            }
        }
    }
}